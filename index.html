<!DOCTYPE html>
<html lang="no">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Investeringskalkulator</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }

    /* ‚îÄ‚îÄ TEMA-VARIABLER ‚îÄ‚îÄ */
    :root {
      --bg:          #f0f4f9;
      --bg-card:     #ffffff;
      --bg-pill:     #f0f4f9;
      --bg-code:     #f0f4f9;
      --border:      #dde3ec;
      --border-div:  #e8edf5;
      --text:        #1a2332;
      --text-muted:  #596880;
      --accent:      #002776;
      --accent-hover:#e2eaf5;
      --shadow:      rgba(0,39,118,0.06);
      --grid-line:   #edf1f7;
      --tooltip-bg:  #ffffff;
      --tooltip-title: #002776;
      --tooltip-body:  #596880;
      --tooltip-border:#dde3ec;
    }

    html[data-theme="dark"] {
      --bg:          #0f1117;
      --bg-card:     #1a1d27;
      --bg-pill:     #22263a;
      --bg-code:     #22263a;
      --border:      #2a2d3e;
      --border-div:  #2a2d3e;
      --text:        #e8eaf0;
      --text-muted:  #8b93a8;
      --accent:      #4a7fd4;
      --accent-hover:#2a3a5e;
      --shadow:      rgba(0,0,0,0.3);
      --grid-line:   #1e2130;
      --tooltip-bg:  #1a1d27;
      --tooltip-title: #a0c4ff;
      --tooltip-body:  #8b93a8;
      --tooltip-border:#2a2d3e;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
      background: var(--bg);
      color: var(--text);
      min-height: 100vh;
      transition: background 0.25s, color 0.25s;
    }

    /* ‚îÄ‚îÄ HEADER ‚îÄ‚îÄ */
    header {
      background: #002776;
      color: #fff;
      padding: 0 40px;
      height: 64px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      box-shadow: 0 2px 8px rgba(0,0,0,0.18);
    }

    .logo {
      display: flex;
      align-items: center;
      gap: 12px;
      font-size: 1.15rem;
      font-weight: 700;
      letter-spacing: -0.3px;
    }

    .logo-icon {
      width: 36px;
      height: 36px;
      background: #fff;
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .logo-icon svg { width: 22px; height: 22px; }

    .header-right {
      display: flex;
      align-items: center;
      gap: 20px;
    }

    .header-sub {
      font-size: 0.82rem;
      color: rgba(255,255,255,0.65);
      font-weight: 400;
    }

    /* ‚îÄ‚îÄ DARK MODE TOGGLE ‚îÄ‚îÄ */
    .theme-toggle {
      background: rgba(255,255,255,0.12);
      border: 1px solid rgba(255,255,255,0.2);
      border-radius: 20px;
      width: 52px;
      height: 28px;
      cursor: pointer;
      position: relative;
      transition: background 0.2s;
      flex-shrink: 0;
    }

    .theme-toggle:hover { background: rgba(255,255,255,0.2); }

    .theme-toggle::after {
      content: '';
      position: absolute;
      top: 3px;
      left: 3px;
      width: 20px;
      height: 20px;
      background: #fff;
      border-radius: 50%;
      transition: transform 0.22s cubic-bezier(.4,0,.2,1);
    }

    html[data-theme="dark"] .theme-toggle::after {
      transform: translateX(24px);
    }

    .toggle-icon {
      position: absolute;
      top: 50%;
      transform: translateY(-50%);
      font-size: 11px;
      pointer-events: none;
      user-select: none;
    }

    .toggle-icon.sun { left: 5px; }
    .toggle-icon.moon { right: 5px; }

    /* ‚îÄ‚îÄ PAGE ‚îÄ‚îÄ */
    .page {
      max-width: 1280px;
      margin: 0 auto;
      padding: 32px 32px 48px;
    }

    .page-title {
      font-size: 1.5rem;
      font-weight: 700;
      color: var(--accent);
      margin-bottom: 4px;
    }

    .page-sub {
      font-size: 0.9rem;
      color: var(--text-muted);
      margin-bottom: 28px;
    }

    /* ‚îÄ‚îÄ MAIN GRID ‚îÄ‚îÄ */
    .main-grid {
      display: grid;
      grid-template-columns: 340px 1fr;
      gap: 24px;
      align-items: start;
    }

    /* ‚îÄ‚îÄ CARDS ‚îÄ‚îÄ */
    .card {
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 24px;
      box-shadow: 0 1px 4px var(--shadow);
      transition: background 0.25s, border-color 0.25s;
    }

    .card-title {
      font-size: 0.72rem;
      font-weight: 700;
      color: var(--accent);
      text-transform: uppercase;
      letter-spacing: 1.1px;
      margin-bottom: 16px;
      padding-bottom: 10px;
      border-bottom: 2px solid var(--border-div);
    }

    /* ‚îÄ‚îÄ INPUTS ‚îÄ‚îÄ */
    .input-block { margin-bottom: 20px; }
    .input-block:last-child { margin-bottom: 0; }

    .input-label {
      display: flex;
      justify-content: space-between;
      align-items: baseline;
      margin-bottom: 8px;
    }

    .input-label span:first-child {
      font-size: 0.88rem;
      color: var(--text-muted);
      font-weight: 500;
    }

    .input-label .val {
      font-size: 1rem;
      font-weight: 700;
      color: var(--accent);
    }

    input[type="range"] {
      width: 100%;
      -webkit-appearance: none;
      height: 5px;
      background: var(--border);
      border-radius: 4px;
      outline: none;
      cursor: pointer;
    }

    input[type="range"]::-webkit-slider-thumb {
      -webkit-appearance: none;
      width: 18px;
      height: 18px;
      background: var(--accent);
      border: 3px solid var(--bg-card);
      border-radius: 50%;
      cursor: pointer;
      box-shadow: 0 0 0 2px var(--accent);
      transition: transform 0.15s;
    }

    input[type="range"]::-webkit-slider-thumb:hover { transform: scale(1.15); }

    .presets {
      display: flex;
      gap: 6px;
      flex-wrap: wrap;
      margin-top: 10px;
    }

    .preset-btn {
      background: var(--bg-pill);
      border: 1px solid var(--border);
      color: var(--text-muted);
      border-radius: 6px;
      padding: 4px 10px;
      font-size: 0.78rem;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.12s;
    }

    .preset-btn:hover { background: var(--accent-hover); color: var(--accent); border-color: var(--accent); }

    .preset-btn.active {
      background: var(--accent);
      border-color: var(--accent);
      color: #fff;
    }

    .divider {
      border: none;
      border-top: 1px solid var(--border-div);
      margin: 20px 0;
    }

    /* ‚îÄ‚îÄ RIGHT COLUMN ‚îÄ‚îÄ */
    .right-col { display: flex; flex-direction: column; gap: 20px; }

    /* ‚îÄ‚îÄ RESULT STRIP ‚îÄ‚îÄ */
    .result-strip {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 14px;
    }

    .result-tile {
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 18px 16px;
      box-shadow: 0 1px 4px var(--shadow);
      transition: background 0.25s, border-color 0.25s;
    }

    .result-tile.accent {
      background: #002776;
      border-color: #002776;
    }

    .result-tile .tile-label {
      font-size: 0.72rem;
      font-weight: 600;
      color: var(--text-muted);
      text-transform: uppercase;
      letter-spacing: 0.9px;
      margin-bottom: 8px;
    }

    .result-tile.accent .tile-label { color: rgba(255,255,255,0.65); }

    .result-tile .tile-value {
      font-size: 1.8rem;
      font-weight: 700;
      color: var(--accent);
      line-height: 1;
    }

    .result-tile.accent .tile-value { color: #fff; }

    .result-tile .tile-unit {
      font-size: 0.78rem;
      color: var(--text-muted);
      margin-top: 4px;
    }

    .result-tile.accent .tile-unit { color: rgba(255,255,255,0.6); }

    /* ‚îÄ‚îÄ CHART CARD ‚îÄ‚îÄ */
    .chart-wrap {
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 24px;
      box-shadow: 0 1px 4px var(--shadow);
      transition: background 0.25s, border-color 0.25s;
    }

    .chart-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 16px;
    }

    .chart-header .card-title { margin-bottom: 0; padding-bottom: 0; border-bottom: none; }

    .legend {
      display: flex;
      gap: 16px;
      flex-wrap: wrap;
      font-size: 0.78rem;
      color: var(--text-muted);
    }

    .legend-item { display: flex; align-items: center; gap: 5px; }

    .legend-line {
      width: 20px;
      height: 3px;
      border-radius: 2px;
    }

    .legend-dot-sm {
      width: 8px;
      height: 8px;
      border-radius: 50%;
    }

    /* ‚îÄ‚îÄ INFO ROWS ‚îÄ‚îÄ */
    .info-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
    }

    .info-pill {
      background: var(--bg-pill);
      border-radius: 8px;
      padding: 12px 14px;
      display: flex;
      flex-direction: column;
      gap: 3px;
      transition: background 0.25s;
    }

    .info-pill .ip-label {
      font-size: 0.72rem;
      color: var(--text-muted);
      font-weight: 500;
      text-transform: uppercase;
      letter-spacing: 0.7px;
    }

    .info-pill .ip-val {
      font-size: 0.95rem;
      font-weight: 700;
      color: var(--accent);
    }

    /* ‚îÄ‚îÄ FORMULA STRIP ‚îÄ‚îÄ */
    .formula-strip {
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 20px 24px;
      box-shadow: 0 1px 4px var(--shadow);
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 14px;
      transition: background 0.25s, border-color 0.25s;
    }

    .formula-item .f-label {
      font-size: 0.7rem;
      font-weight: 600;
      color: var(--text-muted);
      text-transform: uppercase;
      letter-spacing: 0.8px;
      margin-bottom: 5px;
    }

    .formula-item code {
      font-family: "SFMono-Regular", "Courier New", monospace;
      font-size: 0.82rem;
      color: var(--accent);
      background: var(--bg-code);
      padding: 6px 10px;
      border-radius: 6px;
      display: block;
      transition: background 0.25s;
    }

    /* ‚îÄ‚îÄ RESPONSIVE ‚îÄ‚îÄ */
    @media (max-width: 1024px) {
      .main-grid { grid-template-columns: 1fr; }
      .result-strip { grid-template-columns: repeat(2, 1fr); }
      .formula-strip { grid-template-columns: 1fr 1fr; }
    }

    @media (max-width: 600px) {
      .page { padding: 16px; }
      .result-strip { grid-template-columns: 1fr 1fr; }
      .formula-strip { grid-template-columns: 1fr; }
      .info-grid { grid-template-columns: 1fr; }
      .header-sub { display: none; }
    }
  </style>
</head>
<body>

  <header>
    <div class="logo">
      <div class="logo-icon">
        <svg viewBox="0 0 24 24" fill="none" stroke="#002776" stroke-width="2.2" stroke-linecap="round" stroke-linejoin="round">
          <polyline points="22 7 13.5 15.5 8.5 10.5 2 17"/>
          <polyline points="16 7 22 7 22 13"/>
        </svg>
      </div>
      Investeringskalkulator
    </div>
    <div class="header-right">
      <span class="header-sub">Regel av 72 ‚Äî dobling av kapital</span>
      <button class="theme-toggle" id="themeToggle" onclick="toggleTheme()" title="Bytt tema">
        <span class="toggle-icon sun">‚òÄÔ∏è</span>
        <span class="toggle-icon moon">üåô</span>
      </button>
    </div>
  </header>

  <div class="page">
    <div class="page-title">Beregn dobbelingstid</div>
    <div class="page-sub">Juster parametrene for √• se hvordan investeringen din vokser over tid.</div>

    <div class="main-grid">

      <!-- ‚îÄ‚îÄ VENSTRE: KONTROLLER ‚îÄ‚îÄ -->
      <div style="display:flex;flex-direction:column;gap:16px;">

        <div class="card">
          <div class="card-title">Investering</div>

          <div class="input-block">
            <div class="input-label">
              <span>Startbel√∏p</span>
              <span class="val" id="amountDisplay">10 000 kr</span>
            </div>
            <input type="range" id="amountSlider" min="1000" max="1000000" step="1000" value="10000" oninput="update()" />
            <div class="presets" id="amountPresets">
              <button class="preset-btn" onclick="setVal('amountSlider',5000)">5 000</button>
              <button class="preset-btn" onclick="setVal('amountSlider',10000)">10 000</button>
              <button class="preset-btn" onclick="setVal('amountSlider',50000)">50 000</button>
              <button class="preset-btn" onclick="setVal('amountSlider',100000)">100 000</button>
              <button class="preset-btn" onclick="setVal('amountSlider',500000)">500 000</button>
            </div>
          </div>

          <hr class="divider" />

          <div class="input-block">
            <div class="input-label">
              <span>M√•nedlig sparing</span>
              <span class="val" id="monthlyDisplay">500 kr</span>
            </div>
            <input type="range" id="monthlySlider" min="0" max="20000" step="100" value="500" oninput="update()" />
            <div class="presets" id="monthlyPresets">
              <button class="preset-btn" onclick="setVal('monthlySlider',0)">0 kr</button>
              <button class="preset-btn" onclick="setVal('monthlySlider',500)">500 kr</button>
              <button class="preset-btn" onclick="setVal('monthlySlider',1000)">1 000 kr</button>
              <button class="preset-btn" onclick="setVal('monthlySlider',2000)">2 000 kr</button>
              <button class="preset-btn" onclick="setVal('monthlySlider',5000)">5 000 kr</button>
            </div>
          </div>
        </div>

        <div class="card">
          <div class="card-title">Avkastning</div>

          <div class="input-block">
            <div class="input-label">
              <span>√Örlig rente</span>
              <span class="val" id="rateDisplay">7%</span>
            </div>
            <input type="range" id="rateSlider" min="0.5" max="30" step="0.5" value="7" oninput="update()" />
            <div class="presets" id="ratePresets">
              <button class="preset-btn" onclick="setVal('rateSlider',3)">3%</button>
              <button class="preset-btn" onclick="setVal('rateSlider',7)">7%</button>
              <button class="preset-btn" onclick="setVal('rateSlider',10)">10%</button>
              <button class="preset-btn" onclick="setVal('rateSlider',15)">15%</button>
              <button class="preset-btn" onclick="setVal('rateSlider',20)">20%</button>
            </div>
          </div>
        </div>

        <div class="card">
          <div class="card-title">Justeringer</div>

          <div class="input-block">
            <div class="input-label">
              <span>Kapitalskatt</span>
              <span class="val" id="taxDisplay">22%</span>
            </div>
            <input type="range" id="taxSlider" min="0" max="50" step="1" value="22" oninput="update()" />
            <div class="presets" id="taxPresets">
              <button class="preset-btn" onclick="setVal('taxSlider',0)">0%</button>
              <button class="preset-btn" onclick="setVal('taxSlider',22)">22%</button>
              <button class="preset-btn" onclick="setVal('taxSlider',37)">37,84%</button>
            </div>
          </div>

          <hr class="divider" />

          <div class="input-block">
            <div class="input-label">
              <span>Inflasjon</span>
              <span class="val" id="inflationDisplay">3%</span>
            </div>
            <input type="range" id="inflationSlider" min="0" max="15" step="0.5" value="3" oninput="update()" />
            <div class="presets" id="inflationPresets">
              <button class="preset-btn" onclick="setVal('inflationSlider',0)">0%</button>
              <button class="preset-btn" onclick="setVal('inflationSlider',2)">2%</button>
              <button class="preset-btn" onclick="setVal('inflationSlider',3)">3%</button>
              <button class="preset-btn" onclick="setVal('inflationSlider',5)">5%</button>
            </div>
          </div>
        </div>

      </div>

      <!-- ‚îÄ‚îÄ H√òYRE: RESULTATER + GRAF ‚îÄ‚îÄ -->
      <div class="right-col">

        <!-- Resultat-tiles -->
        <div class="result-strip">
          <div class="result-tile accent">
            <div class="tile-label">Regel av 72</div>
            <div class="tile-value" id="rule72">10.3</div>
            <div class="tile-unit">√•r (estimat)</div>
          </div>
          <div class="result-tile">
            <div class="tile-label">Eksakt dobbelingstid</div>
            <div class="tile-value" id="exact">10.24</div>
            <div class="tile-unit">√•r (logaritme)</div>
          </div>
          <div class="result-tile">
            <div class="tile-label">Nominell verdi</div>
            <div class="tile-value" style="font-size:1.3rem" id="doubleNominal">‚Äî</div>
            <div class="tile-unit">ved doblingspunkt</div>
          </div>
          <div class="result-tile">
            <div class="tile-label">Realverdi</div>
            <div class="tile-value" style="font-size:1.3rem" id="doubleReal">‚Äî</div>
            <div class="tile-unit">kj√∏pekraft i dag</div>
          </div>
        </div>

        <!-- Graf -->
        <div class="chart-wrap">
          <div class="chart-header">
            <div class="card-title">Vekst over tid</div>
            <div class="legend">
              <div class="legend-item"><div class="legend-line" style="background:#002776"></div> Nominell</div>
              <div class="legend-item"><div class="legend-line" style="background:#4a90d9"></div> Med sparing</div>
              <div class="legend-item"><div class="legend-line" style="background:#e05c5c"></div> Etter skatt</div>
              <div class="legend-item"><div class="legend-line" style="background:#f59e0b;border-top:2px dashed #f59e0b;height:0"></div> Realverdi</div>
              <div class="legend-item"><div class="legend-dot-sm" style="background:#f59e0b"></div> Dobling</div>
            </div>
          </div>
          <canvas id="growthChart" height="220"></canvas>
        </div>

        <!-- Info-pills -->
        <div class="info-grid">
          <div class="info-pill">
            <div class="ip-label">Etter skatt ved doblingspunkt</div>
            <div class="ip-val" id="doubleAfterTax">‚Äî</div>
          </div>
          <div class="info-pill">
            <div class="ip-label">Avvik Regel av 72 vs eksakt</div>
            <div class="ip-val" id="deviation">‚Äî</div>
          </div>
          <div class="info-pill">
            <div class="ip-label">Effektiv nettorente (etter skatt)</div>
            <div class="ip-val" id="netRate">‚Äî</div>
          </div>
          <div class="info-pill">
            <div class="ip-label">Effektiv realrente (etter skatt + inflasjon)</div>
            <div class="ip-val" id="realRate">‚Äî</div>
          </div>
        </div>

        <!-- Formler -->
        <div class="formula-strip">
          <div class="formula-item">
            <div class="f-label">Regel av 72</div>
            <code>√•r ‚âà 72 / rente</code>
          </div>
          <div class="formula-item">
            <div class="f-label">Eksakt</div>
            <code>√•r = log(2) / log(1 + r)</code>
          </div>
          <div class="formula-item">
            <div class="f-label">Med sparing</div>
            <code>FV = P¬∑(1+r)‚Åø + PMT¬∑((1+rm)^12n‚àí1)/rm</code>
          </div>
        </div>

      </div>
    </div>
  </div>

  <script>
    // ‚îÄ‚îÄ TEMA ‚îÄ‚îÄ
    const saved = localStorage.getItem("theme");
    if (saved) document.documentElement.setAttribute("data-theme", saved);

    function isDark() { return document.documentElement.getAttribute("data-theme") === "dark"; }

    function toggleTheme() {
      const dark = !isDark();
      document.documentElement.setAttribute("data-theme", dark ? "dark" : "light");
      localStorage.setItem("theme", dark ? "dark" : "light");
      updateChartTheme();
    }

    function chartColors() {
      return isDark()
        ? { text: "#8b93a8", grid: "#1e2130", tooltipBg: "#1a1d27", tooltipTitle: "#a0c4ff", tooltipBody: "#8b93a8", tooltipBorder: "#2a2d3e" }
        : { text: "#596880", grid: "#edf1f7", tooltipBg: "#ffffff",  tooltipTitle: "#002776", tooltipBody: "#596880",  tooltipBorder: "#dde3ec" };
    }

    function updateChartTheme() {
      const c = chartColors();
      chart.options.plugins.tooltip.backgroundColor = c.tooltipBg;
      chart.options.plugins.tooltip.titleColor      = c.tooltipTitle;
      chart.options.plugins.tooltip.bodyColor       = c.tooltipBody;
      chart.options.plugins.tooltip.borderColor     = c.tooltipBorder;
      chart.options.scales.x.ticks.color  = c.text;
      chart.options.scales.x.grid.color   = c.grid;
      chart.options.scales.x.title.color  = c.text;
      chart.options.scales.y.ticks.color  = c.text;
      chart.options.scales.y.grid.color   = c.grid;
      chart.options.scales.y.title.color  = c.text;
      chart.update();
    }

    // ‚îÄ‚îÄ CHART ‚îÄ‚îÄ
    const ctx   = document.getElementById("growthChart").getContext("2d");
    const c0    = chartColors();
    const chart = new Chart(ctx, {
      type: "line",
      data: { labels: [], datasets: [] },
      options: {
        responsive: true,
        interaction: { intersect: false, mode: "index" },
        plugins: {
          legend: { display: false },
          tooltip: {
            backgroundColor: c0.tooltipBg,
            titleColor:       c0.tooltipTitle,
            bodyColor:        c0.tooltipBody,
            borderColor:      c0.tooltipBorder,
            borderWidth: 1,
            padding: 12,
            callbacks: {
              label: c => "  " + c.dataset.label + ": " + Math.round(c.parsed.y).toLocaleString("no-NO") + " kr"
            }
          }
        },
        scales: {
          x: {
            ticks: { color: c0.text, font: { size: 11 } },
            grid:  { color: c0.grid },
            title: { display: true, text: "√Ör", color: c0.text, font: { size: 11 } }
          },
          y: {
            ticks: { color: c0.text, font: { size: 11 }, callback: v => Math.round(v).toLocaleString("no-NO") + " kr" },
            grid:  { color: c0.grid },
            title: { display: true, text: "Verdi", color: c0.text, font: { size: 11 } }
          }
        }
      }
    });

    function fmt(n) { return Math.round(n).toLocaleString("no-NO") + " kr"; }
    function fmtPct(n) { return n.toFixed(2) + "%"; }

    function fv(start, monthly, annualRate, years) {
      const rm     = annualRate / 100 / 12;
      const months = years * 12;
      const lump   = start * Math.pow(1 + annualRate / 100, years);
      const sav    = rm === 0 ? monthly * months : monthly * (Math.pow(1 + rm, months) - 1) / rm;
      return lump + sav;
    }

    function fvAfterTax(start, monthly, annualRate, tax, years) {
      return fv(start, monthly, annualRate * (1 - tax / 100), years);
    }

    function realVal(nominalFv, inflation, years) {
      return nominalFv / Math.pow(1 + inflation / 100, years);
    }

    function buildChart(rate, start, monthly, tax, inflation) {
      const exact = Math.log(2) / Math.log(1 + rate / 100);
      const years = Math.ceil(exact * 2.5);
      const labels = [], nom = [], sav = [], atax = [], real = [], dpts = [];

      for (let y = 0; y <= years; y++) {
        labels.push(y);
        const n = start * Math.pow(1 + rate / 100, y);
        const s = fv(start, monthly, rate, y);
        const t = fvAfterTax(start, monthly, rate, tax, y);
        const r = realVal(t, inflation, y);
        nom.push(n); sav.push(s); atax.push(t); real.push(r);
        dpts.push(y === Math.round(exact) ? n : null);
      }

      chart.data.labels   = labels;
      chart.data.datasets = [
        { label:"Nominell",    data: nom,  borderColor:"#002776", backgroundColor:"rgba(0,39,118,0.04)",   fill:true, tension:0.4, pointRadius:2, pointHoverRadius:5 },
        { label:"Med sparing", data: sav,  borderColor:"#4a90d9", backgroundColor:"rgba(74,144,217,0.04)", fill:true, tension:0.4, pointRadius:2, pointHoverRadius:5 },
        { label:"Etter skatt", data: atax, borderColor:"#e05c5c", backgroundColor:"rgba(224,92,92,0.04)",  fill:true, tension:0.4, pointRadius:2, pointHoverRadius:5 },
        { label:"Realverdi",   data: real, borderColor:"#f59e0b", backgroundColor:"rgba(245,158,11,0.04)", fill:true, tension:0.4, pointRadius:2, pointHoverRadius:5, borderDash:[5,4] },
        { label:"Dobling",     data: dpts, borderColor:"#f59e0b", backgroundColor:"#f59e0b", pointRadius:9, pointHoverRadius:11, showLine:false }
      ];
      chart.update();
    }

    function syncPresets(groupId, matchFn) {
      document.querySelectorAll(`#${groupId} .preset-btn`).forEach(btn => {
        btn.classList.toggle("active", matchFn(btn));
      });
    }

    function update() {
      const rate      = parseFloat(document.getElementById("rateSlider").value);
      const amount    = parseFloat(document.getElementById("amountSlider").value);
      const monthly   = parseFloat(document.getElementById("monthlySlider").value);
      const tax       = parseFloat(document.getElementById("taxSlider").value);
      const inflation = parseFloat(document.getElementById("inflationSlider").value);

      document.getElementById("rateDisplay").textContent      = rate + "%";
      document.getElementById("amountDisplay").textContent    = fmt(amount);
      document.getElementById("monthlyDisplay").textContent   = fmt(monthly);
      document.getElementById("taxDisplay").textContent       = tax + "%";
      document.getElementById("inflationDisplay").textContent = inflation + "%";

      const rule72  = 72 / rate;
      const exact   = Math.log(2) / Math.log(1 + rate / 100);
      const diff    = Math.abs(rule72 - exact);
      const netR    = rate * (1 - tax / 100);
      const realR   = ((1 + netR / 100) / (1 + inflation / 100) - 1) * 100;

      const nomAtD  = fv(amount, monthly, rate, exact);
      const taxAtD  = fvAfterTax(amount, monthly, rate, tax, exact);
      const realAtD = realVal(taxAtD, inflation, exact);

      document.getElementById("rule72").textContent         = rule72.toFixed(1);
      document.getElementById("exact").textContent          = exact.toFixed(2);
      document.getElementById("deviation").textContent      = diff.toFixed(2) + " √•r";
      document.getElementById("doubleNominal").textContent  = fmt(nomAtD);
      document.getElementById("doubleAfterTax").textContent = fmt(taxAtD);
      document.getElementById("doubleReal").textContent     = fmt(realAtD);
      document.getElementById("netRate").textContent        = fmtPct(netR);
      document.getElementById("realRate").textContent       = fmtPct(realR);

      syncPresets("amountPresets",    btn => parseFloat(btn.textContent.replace(/\s/g,"")) === amount);
      syncPresets("monthlyPresets",   btn => parseFloat(btn.textContent.replace(/[^\d]/g,"")) === monthly);
      syncPresets("ratePresets",      btn => parseFloat(btn.textContent) === rate);
      syncPresets("taxPresets",       btn => parseFloat(btn.textContent) === tax);
      syncPresets("inflationPresets", btn => parseFloat(btn.textContent) === inflation);

      buildChart(rate, amount, monthly, tax, inflation);
    }

    function setVal(id, v) { document.getElementById(id).value = v; update(); }

    update();
  </script>

</body>
</html>
